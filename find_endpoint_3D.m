function [endpoint,X1,X2]=find_endpoint_3D(A)

s=zeros(3,3,3);
s(2,2,2)=1;

rank=1;
for i=1:3
    for j=1:3
        for k=1:3
            B(:,:,:,rank)=s;
            if ~(i==j && i==k && j==k && i==2)
                B(i,j,k,rank)=1;
                rank=rank+1;
            end
        end
    end
end
     
% B(:,:,:,27)=s;
% B(2,2,1,27)=1;
% B(3,2,2,27)=1;
% 
% B(:,:,:,28)=s;
% B(2,2,1,28)=1;
% B(1,2,2,28)=1;
% 
% B(:,:,:,29)=s;
% B(2,2,1,29)=1;
% B(2,3,2,29)=1;
% 
% B(:,:,:,30)=s;
% B(2,2,1,30)=1;
% B(2,1,2,30)=1;
% 
% B(:,:,:,31)=s;
% B(2,2,3,31)=1;
% B(3,2,2,31)=1;
% 
% B(:,:,:,32)=s;
% B(2,2,3,32)=1;
% B(1,2,2,32)=1;
% 
% B(:,:,:,33)=s;
% B(2,2,3,33)=1;
% B(2,3,2,33)=1;
% 
% B(:,:,:,34)=s;
% B(2,2,3,34)=1;
% B(2,1,2,34)=1;
% 
% B(:,:,:,35)=s;
% B(2,2,2,35)=0;
% B(2,2,3,35)=1;
% B(2,2,1,35)=1;
% B(3,2,2,35)=1;
% 
% B(:,:,:,36)=s;
% B(2,2,2,36)=0;
% B(2,2,3,36)=1;
% B(2,2,1,36)=1;
% B(1,2,2,36)=1;
% 
% B(:,:,:,37)=s;
% B(2,2,2,37)=0;
% B(2,2,3,37)=1;
% B(2,2,1,37)=1;
% B(2,3,2,37)=1;
% 
% B(:,:,:,38)=s;
% B(2,2,2,38)=0;
% B(2,2,3,38)=1;
% B(2,2,1,38)=1;
% B(2,1,2,38)=1;


% for time=1:5
%     for i=1:rank-1 
        SE=B(:,:,:,i);
        X1=A-HMT(A,SE);
%     end
%     A=X1;
% end

X2=HMT(X1,B(:,:,:,1));

for i=2:rank-1
    X2=X2 | HMT(X1,B(:,:,:,i));
end

d1=reshape(X2,prod(size(X2)),1);
[indx3,indy3,indz3]=ind2sub(size(X2),find(d1==1));
endpoint=[indx3,indy3,indz3];

